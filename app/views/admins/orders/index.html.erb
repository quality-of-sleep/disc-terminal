<h1>注文一覧</h1>

<%= form_with model: Order, url: admins_orders_path, method: :get do |f|%>
	<%= f.select :delivery_status, Order.delivery_statuses.keys.to_a, {}, class: "btn btn-default dropdown-toggle" %>
	<%= f.submit "絞り込む", class: "btn btn-primary" %>
<% end %>

<div class="col">
	<table class="table">
		<thead>
			<tr>
				<% def sortTh(a,contName) %>
					<% if request.fullpath.include?('desc') %>
						<% link_to a, sort: contName %>
					<% else %>
						<% link_to a, sort: "#{contName} desc" %>
					<% end %>
				<% end %>

				<th><%= sortTh('注文日時','created_at') %></th>
				<th><%= sortTh('注文ID','id') %></th>
				<th>商品</th>
				<th>配送先</th>
				<th>合計金額(税込)</th>
				<th><%= sortTh('配送状況', 'delivery_status') %></th>
				<th>購入者</th>
			</tr>
		</thead>
		<tbody>
			<% @orders.each do |order| %>
				<tr>
					<td><%= order.created_at.strftime('%Y/%m/%d %H:%M') %></td>
					<td><%= link_to order.id, admins_order_path(order) %></td>
					<td>
						<% if order.order_details.count == 1 %>
							<%= order.order_details[0].item_name %>
						<% else %>
							<%= order.order_details[0].item_name %>　他<%= order.order_details.count %>点
						<% end %>
					</td>
					<td><%= order.address %></td>
					<td>¥ <%= order.total_price.to_s(:delimited) %></td>
					<td>
						<%= form_with model: order, url: admins_order_path(order.id), method: :patch, local: true do |f|%>
						<div>
							<%= f.select :delivery_status, Order.delivery_statuses.keys.to_a, {}, class: "btn btn-default dropdown-toggle" %>
						</div>
						<div>
							<%= f.submit "変更", class: "btn btn-primary" %>
						</div>
					<% end %>
					</td>
					<td><%= order.user_name %></td>

				</tr>
			<% end %>
		</tbody>
	</table>
</div>

<%
=begin
%>
<%= paginate @orders, class: "paginate" %>

<%= form_with model: Order, url: admins_orders_path, method: :get, local: true do |f|%>
<%
=end
%>