<h1>注文一覧</h1>


<%= form_tag admins_orders_path, method: :get do %>
	<%= select_tag 'delivery_status', options_for_select([["配送準備中",'1'],["配送中",'2'],["配送済",'3'],['キャンセル','4']]), class: "btn btn-default dropdown-toggle" %>
  <%= submit_tag '絞り込む', class: "btn btn-primary" %>
 <% end %>

 <%= link_to 'リセット', admins_orders_path, class: "btn btn-default" %>

<div class="col">
	<table class="table">
		<thead>
			<tr>
				<th><%= sortTh('注文日時','created_at') %></th>
				<th><%= sortTh('注文ID','id') %></th>
				<th>商品</th>
				<th><%= sortTh('配送先', 'address') %></th>
				<th><%= sortTh('合計金額(税込)', 'total_price') %></th>
				<th><%= sortTh('配送状況', 'delivery_status') %></th>
				<th><%= sortTh('購入者', 'user_name') %></th>
			</tr>
		</thead>
		<tbody>
			<% @orders.each do |order| %>
				<tr>
					<td><%= order.created_at.strftime('%Y/%m/%d %H:%M') %></td>
					<td><%= link_to order.id, admins_order_path(order) %></td>
					<td>
						<% if order.order_details.count == 1 %>
							<%= order.order_details[0].item_name %>
						<% else %>
							<%= order.order_details[0].item_name %>　他<%= order.order_details.count %>点
						<% end %>
					</td>
					<td><%= order.address %></td>
					<td>¥ <%= order.total_price.to_s(:delimited) %></td>
					<td>
						<%= form_with model: order, url: admins_order_path(order.id), method: :patch, local: true do |f|%>
						<div>
							<%= f.select :delivery_status, Order.delivery_statuses.keys.to_a, {}, class: "btn btn-default dropdown-toggle" %>
						</div>
						<div>
							<%= f.submit "変更", class: "btn btn-primary" %>
						</div>
					<% end %>
					</td>
					<td><%= full_name(order.user) %></td>
				</tr>
			<% end %>
		</tbody>
	</table>
</div>

<%= paginate @orders, class: "paginate" %>